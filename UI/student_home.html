<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="student_home.css">
    <title>Document</title>
</head>
<body onload="loginUser();courseOfStudent();">
    <div>
        <header>
            <h1>COURSE MANAGEMENT SYSTEM</h1>
        </header> 
    </div>
    <div class="userbar">
      
        <p id="message"></p>
        <a href="#" id="user">User name</a>
        <a href="https://stark-ridge-06549.herokuapp.com/">Log out</a>
    </div>
    <div id="editInfo">
        <div class="editInformation">
            
            <form action="">
                <h3>Edit your information</h3>
                <label for="fname">First name</label>
                <input type="text" id="fname" placeholder="First name">
                <label for="mname">Middle name</label>
                <input type="text" id="mname" placeholder="Middle name">
                <label for="lname">Last name</label>
                <input type="text" id="lname" placeholder="Last name">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="email"> 
                <label for="phone">Phone</label>
                <input type="number" id="phone" placeholder="Phone number">
                <label for="userType">User type</label>
                <select name="userType" id="userType">
                    <option value="teacher">Teacher</option>
                    <option value="student">Student</option>
                </select>
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Password">
                <label for="passwordConfirm">Password confirm</label>
                <input type="password" id="passwordConfirm" placeholder="Password Confirm">
                <input type="submit" value="Save">
                <input type="button" id="cancel3" value="Cancel">
            </form>
        </div>
    </div>
  
        
           <div id="courseList" ></div>
           
           
        
    <div>
        <footer>
            <a href="http://">OAMK.fi</a>
            <a href="http://">Oiva</a>
            <a href="http://">Peppi</a>
            <a href="http://">Library</a>
            <a href="http://">Help</a>
        </footer>
    </div>

    

    <script>
           
            document.getElementById("user").addEventListener("click",function(){
            document.querySelector("#editInfo").style.display="flex";
    });
        document.getElementById("cancel3").addEventListener("click",function(){
            document.querySelector("#editInfo").style.display="none";
    })
// show login user name
    function loginUser(){
    let userEmail=localStorage.getItem("userEmail");
        //create XHR Object
        var xhr = new XMLHttpRequest();
        //open -type, url/file,async
        xhr.open("GET", 'https://stark-ridge-06549.herokuapp.com/db', true);
        xhr.onload=function(){
            if(this.status==200){
                var userInfo=JSON.parse (this.responseText);

                
                var userIndex=userInfo.map(object => object.email).indexOf(userEmail);
                var username=userInfo[userIndex].fname;
                
                document.getElementById("user").innerText=username;
            }
    }
    //send request
    xhr.send();
}

// show how many courses this student have taken   

function courseOfStudent(){
    let userEmail=localStorage.getItem("userEmail");
        //create XHR Object
        var xhr = new XMLHttpRequest();
        //open -type, url/file,async
        xhr.open("GET", 'https://stark-ridge-06549.herokuapp.com/db3', true);
        xhr.onload=function(){
            if(this.status==200){
                var trafficLight=JSON.parse (this.responseText);
                output='';
                for(var i in trafficLight){
                    if(trafficLight[i].studentemail==userEmail){
                        output+='<form action="/confirm" method="POST">'
                        +'<input type="hidden" name="studentEmail" value="'+userEmail+'" >'    
                        +'<input name=courseName value="'+trafficLight[i].coursename+'"></input>'+'<br />'+'<br />'
                        +'<lable for='+trafficLight[i].date01+'>'+trafficLight[i].date01+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date01+' name="lesson01" value="'+trafficLight[i].lesson01+'">'
                           
                            +'<option value="Green">Green</option>'
                            +'<option  value="Yellow">Yellow</option>'
                            +'<option  value="Red" >Red</option>'
                        +'</select>'
                        +'<lable for='+trafficLight[i].date02+'>'+trafficLight[i].date02+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date02+' name="lesson02" value="'+trafficLight[i].lesson02+'">'
                          
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'   
                        +'<lable for='+trafficLight[i].date03+'>'+trafficLight[i].date03+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date03+' name="lesson03" value="'+trafficLight[i].lesson03+'">'
                          
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'   
                        +'<lable for='+trafficLight[i].date04+'>'+trafficLight[i].date04+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date04+' name="lesson04" value="'+trafficLight[i].lesson04+'">'
                       
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'   
                        +'<lable for='+trafficLight[i].date05+'>'+trafficLight[i].date05+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date05+' name="lesson05" value="'+trafficLight[i].lesson05+'">'
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'   
                        +'<lable for='+trafficLight[i].date06+'>'+trafficLight[i].date06+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date06+' name="lesson06" value="'+trafficLight[i].lesson06+'">'
                           
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'   
                        +'<lable for='+trafficLight[i].date07+'>'+trafficLight[i].date07+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date07+' name="lesson07" value="'+trafficLight[i].lesson07+'">'
                     
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'   
                        +'<lable for='+trafficLight[i].date08+'>'+trafficLight[i].date08+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date08+' name="lesson08" value="'+trafficLight[i].lesson08+'">'
                          
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'   
                        +'<lable for='+trafficLight[i].date09+'>'+trafficLight[i].date09+'</lable>'
                        +'<select type="text" class="trafficLight" id='+trafficLight[i].date09+' name="lesson09" value="'+trafficLight[i].lesson09+'">'
                         
                            +'<option value="Green">Green</option>'
                            +'<option value="Yellow">Yellow</option>'
                            +'<option value="Red" >Red</option>'
                        +'</select>'       
                                              
                        +'<input type="submit" value="Confirm"></input>'+'</form>'
                        +'<br />'+'<br />'+'<br />'
                        ;
                       }
                }
               
                document.getElementById("courseList").innerHTML=output;
               
                
        //get notification for marking the light
                const elements = document.getElementsByClassName('trafficLight');
                const today = new Date().toISOString().slice(0, 10);
                let  unmarked=Number(0);
                for (const element of elements) {
                   
                    if (element.value='Unmark' && element.id<today) {
                        unmarked +=1;
                    }
                   
                }
                if (unmarked==0) {
                    document.getElementById("message").innerText='You have'+' '+unmarked+' '+'traffic light to mark.'
                    document.getElementById("message").style.color='black';

                }else {
                    document.getElementById("message").innerText='You have'+' '+unmarked+' '+'traffic lights to mark!'
                    document.getElementById("message").style.color='red';

                }
                
            }
    }
    //send request
    xhr.send();
}

// traffic light control
/*function trafficLight(){     
      
    const elements = document.getElementsByClassName('trafficLight');
    for (const element of elements) {
        let color = element.value; 
       
            switch (color) {
                case 'green':
                    element.style.backgroundColor = 'green';
                    break;
                case 'yellow':
                    element.style.backgroundColor = 'yellow';
                    break;
                case 'red':
                    element.style.backgroundColor = 'red';
                    break;
               default:
                    element.style.backgroundColor = 'white';
                    break;                  
            }
           console.log(color);
           
        }
        
    }
*/


    </script>
</body>
</html>